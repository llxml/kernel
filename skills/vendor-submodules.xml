<skill name="vendor-submodules" v="3">
<desc>Managing shared library dependencies via git submodules in vendor/</desc>

<overview>
Libraries follow the standard project layout with `main/` (git repo) and `kernel/` (worktree for vendoring). Consumer projects add submodules pointing to kernel worktrees.
</overview>

<tools>
- `git submodule` commands
- Optional: helper scripts for common operations
</tools>

<library_locations>
Libraries are expected at configured paths:
```
<library-root>/
├── main/                   # Git repository
└── kernel/                 # Worktree for vendoring
```

Submodule URLs use `file://` protocol pointing to the kernel worktree.
</library_locations>

<adding_vendor>
```bash
cd main
git submodule add file://<library-root>/kernel vendor/<name>
```

Example:
```bash
git submodule add file:///home/dev/libs/mylib/kernel vendor/mylib
```
</adding_vendor>

<build_integration>
Reference vendored libraries in your build config using relative paths:

```
vendor/<name>/             # Point your build system here
vendor/<name>/src/         # Or to specific subdirectories
```

Avoid:
- Absolute paths
- Git URLs in build configs
- Patches or overrides that break when vendored elsewhere
</build_integration>

<library_requirements>
For a library to be vendorable:

1. Must have kernel worktree:
```bash
cd <library-root>/main
git branch stable
git worktree add ../kernel stable
```

2. Library must be self-contained - no references to parent workspace configs or paths that won't exist when vendored.
</library_requirements>

<publishing>
"Publishing" = merging main to stable:
```bash
cd <library-root>/kernel
git merge main
```
Or: `git -C kernel merge main`
</publishing>

<updating_vendor>
```bash
cd main/vendor/<name>
git fetch origin
git checkout origin/HEAD
cd ../..
git add vendor/<name>
```
</updating_vendor>

<after_clone>
```bash
cd main
git submodule update --init --recursive
```
</after_clone>

<one_time_setup>
Enable git file protocol (once per machine):
```bash
git config --global protocol.file.allow always
```
</one_time_setup>
</skill>

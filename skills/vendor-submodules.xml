<skill name="vendor-submodules" v="3">
<desc>Managing shared library dependencies via git submodules in vendor/</desc>

<overview>
Libraries follow the standard project layout with `main/` (git repo) and `stable/` (branch for vendoring). Consumer projects add submodules pointing to the stable branch. Some projects use a `kernel/` worktree instead of `stable/` - the pattern is the same.
</overview>

<tools>
- `git submodule` commands
- Optional: helper scripts for common operations
</tools>

<library_locations>
Libraries are expected at configured paths:
```
<library-root>/
├── main/                   # Git repository
└── stable/                 # Stable branch (or kernel/ worktree)
```

Submodule URLs use `file://` protocol pointing to the stable branch or worktree.
</library_locations>

<adding_vendor>
```bash
cd main
git submodule add file://<library-root>/stable vendor/<name>
```

Replace `<library-root>` with the absolute path to the library on your machine.
</adding_vendor>

<build_integration>
Reference vendored libraries in your build config using relative paths:

```
vendor/<name>/             # Point your build system here
vendor/<name>/src/         # Or to specific subdirectories
```

Avoid:
- Absolute paths
- Git URLs in build configs
- Patches or overrides that break when vendored elsewhere
</build_integration>

<library_requirements>
For a library to be vendorable:

1. Must have a stable branch:
```bash
cd <library-root>/main
git branch stable
```

2. Library must be self-contained - no references to parent workspace configs or paths that won't exist when vendored.
</library_requirements>

<publishing>
"Publishing" = merging main to stable:
```bash
cd <library-root>/main
git checkout stable && git merge main && git checkout main
```
</publishing>

<updating_vendor>
```bash
cd main/vendor/<name>
git fetch origin
git checkout origin/HEAD
cd ../..
git add vendor/<name>
```
</updating_vendor>

<after_clone>
```bash
cd main
git submodule update --init --recursive
```
</after_clone>

<one_time_setup>
Enable git file protocol (once per machine):
```bash
git config --global protocol.file.allow always
```
</one_time_setup>
</skill>
